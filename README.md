# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
export interface IProduct {
	id: string,
	description: string,
	image: string,
	title: string,
	category: productCategory,
	price: number ,
}
```

Интерфейс для модели данных товаров (каталог и корзина)

```
export interface ICatalog {
	items: IProduct[],
	basket: IProduct[],
}

```

Интерфейс финального запроса на сервер для оформления покупки

```
export interface IOrder {
	payment: string,
	email: string,
	phone: string,
	address: string,
	total: number,
	items: string[]
}
```

Интерфейс для модели данных заказа (сейчас он только отправляется на сервер, но возможно расширение функциональности в
будущем)

```
export interface IOrderData {
    order: IOrder,
}
```

Интерфейс успешного ответа от сервера

```
export interface IApiSuccess {
	id: string,
	total: number,
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- `Слой Представления`, отвечает за отображение данных на странице,
- `Слой Данных`, отвечает за хранение и изменение данных
- `Презентер`, отвечает за связь представления и данных.

### Базовый код

#### <u>Класс EventEmitter</u>

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в
презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

Дополнительно реализованы методы onAll и offAll — для подписки на все события и сброса всех
подписчиков.

#### <u>Класс AppApi</u>

Является слоем коммуникации.Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие
взаимодействие с бэкендом сервиса.

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с
заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил
  сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт
  переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть
  переопределен заданием третьего параметра при вызове.

### Слой данных

#### <u>Класс ProductsData</u>

Класс отвечает за хранение и логику работы с данными товаров и корзиной.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- `_items`: IProduct[] - массив объектов товаров
- `_basket`: IProduct[] - массив объектов товаров находящихся в корзине
- `events`: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными (часть методов в данном приложении не
используются, однако были изначально добавлены, и возможно пригодятся в дальнейшем.)

Основные использующиеся методы:

- `addToBasket` - добавляет товар в корзину.
- `removeFromBasket` - удаляет товар из корзины.
- `getProduct`: IProduct - возвращает товар по его id
  Так-же сеттеры и геттеры для сохранения и получения данных из полей класса и функции подсчета основных необходимых
  параметров.

#### <u>Класс OrderData</u>

Класс отвечает за хранение и логику работы с данными заказа клиента.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- `_order`: IOrder - бъект заказа.
- `events`: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так как сейчас никаких действий с этими данными кроме отпраки на сервер не производится, методами класса являются только
сеттеры всех необходимых полей.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.\
Все классы представления наследуются от общего обстрактного класса `Component`, который описывает основные способы
взаимодействия с DOM элементами и имеет функцию `render`, которая возвращает готовый элемент для вывода на экран.\
В конструктор классов передается DOM элемент темплейта а также экземпляр `EventEmitter` для инициации событий.\
В классах устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя
генерируются соответствующие события.

#### <u>Класс Product</u>

Отвечает за отображение карточек товара на сайте.В приложении товар может отображаться в разных представлениях (главная
страница, модалка и корзина) для этого создан абстрактный родительский класс -`Product` в котором инициализируется общая
для всех 3-х видов карточек информация и дочерний класс -`RenderProduct` который в зависимости от переданного шаблона
создает карточку нужного вида, тоесть добавляются элементы и геттеры и сеттеры соответсвующие заданному шаблону.\

Все поля классов связанных с карточками:

- `productTitle`: HTMLElement : Элемент названия товара.
- `productPrice`: HTMLElement : Элемент цены товара.
- `productCategory`: HTMLElement : Элемент цены товара.
- `productImage`: HTMLImageElement : Элемент изображения товара.
- `productDescription`: HTMLElement : Элемент описания товара.
- `productBasketNumber`: HTMLElement : Элемент порядкого номера товара в корзине.
- `buyButton`: HTMLButtonElement : Элемент кнопки добавления товара в корзину.
- `deleteButton`: HTMLButtonElement : Элемент кнопки удаления товара из корзины.

Методы:

- Основные методы это геттеры и сеттеры для соответсвующих полей. А так же обработчики кнопок.

#### <u>Класс Page</u>

Page отображает содержимое главной страницы приложения - каталог продуктов, корзину и счетчик элементов.\
При создании инициализируется объект страницы, с основными элементами главной страницы, а так же добавляется обработчик
события клика на элемент корзины.

Поля класса:

- `_catalog`: HTMLElement: Элемент каталога товаров.
- `_basket`: HTMLElement: Элемент корзины.
- `_counter`: HTMLElement: Элемент счетчика товаров в корзине.
- `_wrapper`: HTMLElement: Элемент обертки страницы.

Методы класса - сеттеры для основных элементов.

#### <u>Класс Basket</u>

Basket управляет отображением корзины с покупками.

Поля класса:

- `_list`: HTMLElement: Элемент списка товаров.
- `_total`: HTMLElement: Элемент для отображения общей стоимости товаров.
- `_button`: HTMLElement: Кнопка оформления заказа.

Методы класса - сеттеры для основных элементов.

#### <u>Класс Modal</u>

Отвечает за создание и управление содержимым модального окна.

Поля класса:

- `_closeButton`: HTMLButtonElement: Кнопка закрытия модального окна.
- `_content`: HTMLElement: Элемент содержимого модального окна.

Методы класса:

- `open`: Открывает модальное окно и отправляет соответствующее событие.
- `close`: Закрывает модальное окно, очищает контент и отправляет соответствующее событие.
- `render`: Выполняет рендеринг содержимого и открытие модального окна.
  А так же сеттер для установки контента.

#### <u>Класс Form</u>

Абстрактный родительский класс для конкретных видов форм в приложении.\
Управляет отображением и взаимодействием с формами.

Поля класса:

- `_submit`: HTMLButtonElement: Кнопка сабмита формы.
- `_errors`: HTMLElement: Элемент для отображения ошибок формы.

Методы класса:

- `onInputChange`: Эмиттер события изменения данных в форме.

`Класс AddressForm` - дочерний класс `Form`.
Предназначен для работы с формой для указания способа оплаты и ввода адреса доставки товара.

Поле класса:

- `_onlineButton`: HTMLButtonElement - Кнопка оплаты онлайн;
- `_offlineButton`: HTMLButtonElement - Кнопка оплаты оффлайн;

Методы класса:
Сеттеры для установки адреса и работы с кнопкой выбора способа оплаты.

`Класс ContactsForm` - дочерний класс `Form`.
Предназначен для работы с формой для указания email и телефона покупателя.

Методы класса:
Сеттеры для установки email и телефона.

#### <u>Класс Success</u>

Класс отвечает за отображение интерфейса успешной покупки.\
В конструктор кроме контейнера приниает обработчик клика на элемент закрытия - действия которые необходимо сделать при
закрытии данного окна.

Поля класса:

- `_close`: HTMLElement: Элемент для кнопки закрытия.
- `_total`: HTMLElement: Элемент для отображения итоговой суммы.

Метод - сеттер суммы списания.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль
презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий,
описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классом модели данных)*

- `products:changed` - изменение массива товаров
- `basket:changed` - изменение массива товаров в корзине
- `basket:addProduct` - добавление товара в корзину
- `basket:deleteProduct` - удаление товара из корзины

  *События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за
  представление)*

- `modal:open` - событие, генерируемое при открытии модального окна
- `modal:close` - событие, генерируемое при закрытии модального окна
- `product:select` - открытие модального окна с подробным описанием товара
- `basket:open` - открытие модального окна с корзиной
- `^(order|contacts)\..*:change` - RegExp выражение описывающее название события, генерируемое при изменении данных в
  input-полях форм
- `order:open` - открытие модального окна с формой оплаты и адреса
- `order:submit` - событие, генерируемое при подтверждении в модальном окне с формой оплаты и адреса. В нашем случае
  открытие модального окна с почтой и телефоном.
- `contacts:submit` - событие, генерируемое при подтверждении в модальном окне с почтой и телефоном. В нашем случае
  открытие модального окна успешного заказа.
